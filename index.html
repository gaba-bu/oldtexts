<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Our Chats</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  #mediaGrid img, #mediaGrid video{
  width:100%;
  height:120px;
  object-fit:cover;
  border-radius:8px;
  cursor:pointer;
}

  
  :root{
  --bg:#efeae2;
  --header:#075e54;
  --left:#ffffff;
  --right:#dcf8c6;
  --text:#111;
  --date:#666;
}

.dark{
  --bg:#0b141a;
  --header:#202c33;
  --left:#202c33;
  --right:#005c4b;
  --text:#e9edef;
  --date:#aebac1;
}


body{
  margin:0;
  font-family: system-ui, -apple-system, sans-serif;
  background:var(--bg);
color:var(--text);

}

/* Header */
.header{
  background:var(--header);
color:var(--text);

  padding:14px;
  text-align:center;
  font-weight:600;
  position:sticky;
  top:0;
  z-index:10;
}

/* Chat container */
.chat{
  max-width:650px;
  margin:auto;
  padding:12px;
}

/* Date */
.date{
  text-align:center;
  font-size:12px;
  color:var(--date);

  margin:14px 0;
}

/* Message bubble */
.msg{
  max-width:75%;
  padding:8px 10px;
  margin-bottom:6px;
  border-radius:10px;
  font-size:14px;
  line-height:1.4;
  white-space:pre-wrap;
  word-wrap:break-word;
}

/* Her */
.left{
  background:var(--left);
color:var(--text);

  margin-right:auto;
  border-bottom-left-radius:2px;
}

/* You */
.right{
  background:var(--right);
color:var(--text);

  margin-left:auto;
  border-bottom-right-radius:2px;
}

/* Time */
.time{
  display:block;
  text-align:right;
  font-size:10px;
  color:#555;
  margin-top:3px;
}

/* Media */
img, video, audio{
  max-width:100%;
  border-radius:8px;
  margin-top:5px;

  #mediaGrid img, #mediaGrid video{
  width:100%;
  height:120px;
  object-fit:cover;
  border-radius:8px;
  cursor:pointer;
}

}

</style>
</head>

<body>

<div class="header">
  <span>Mishu</span>

  <div style="float:right">
    <button id="mediaBtn" style="background:none;border:none;color:inherit;font-size:16px;cursor:pointer;margin-right:10px;">ðŸ“·</button>
    <button id="themeBtn" style="background:none;border:none;color:inherit;font-size:18px;cursor:pointer;">ðŸŒ™</button>
  </div>
</div>

<div id="chat" class="chat"></div>
<div id="mediaPanel" style="
display:none;
max-width:700px;
margin:auto;
padding:10px;
">

<div id="mediaGrid" style="
display:grid;
grid-template-columns:repeat(3,1fr);
gap:6px;
"></div>

</div>


<script>

const MY_NAME = "Samuel Manas";  // <<< IMPORTANT: must match chat.json sender exactly

fetch("chat.json")
.then(r => r.json())
.then(data => {

  const chat = document.getElementById("chat");
  let lastDate = "";

  for (let i = 0; i < data.length; i++) {

    const m = data[i];
    if(!m) continue;

    /* Date separator */
    if(m.date && m.date !== lastDate){
      const d = document.createElement("div");
      d.className = "date";
      d.textContent = m.date;
      chat.appendChild(d);
      lastDate = m.date;
    }

    const bubble = document.createElement("div");
    bubble.className = "msg " + (m.sender === MY_NAME ? "right":"left");

    /* TEXT */
    if(m.type === "text"){
      if(m.content && m.content.trim() !== ""){
        bubble.appendChild(document.createTextNode(m.content));
      } else {
        continue;
      }
    }

    /* IMAGE + STICKER (.webp works automatically) */
    else if(m.type === "image"){
      if(!m.file) continue;
      const img = document.createElement("img");
      img.src = "media/" + m.file;
      img.loading = "lazy";
      bubble.appendChild(img);
    }

    /* VIDEO */
    else if(m.type === "video"){
      if(!m.file) continue;
      const v = document.createElement("video");
      v.src = "media/" + m.file;
      v.controls = true;
      bubble.appendChild(v);
    }

    /* AUDIO / VOICE NOTE */
    else if(m.type === "audio"){
      if(!m.file) continue;
      const a = document.createElement("audio");
      a.src = "media/" + m.file;
      a.controls = true;
      bubble.appendChild(a);
    }

    /* FILE */
    else if(m.type === "file"){
      if(!m.file) continue;
      const f = document.createElement("div");
      f.textContent = "ðŸ“Ž " + m.file;
      bubble.appendChild(f);
    }

    /* Time */
    if(m.time){
      const t = document.createElement("span");
      t.className="time";
      t.textContent=m.time;
      bubble.appendChild(t);
    }

    chat.appendChild(bubble);
  }

  /* scroll to bottom */
  setTimeout(()=>{
    window.scrollTo(0,document.body.scrollHeight);
  },300);

  const btn = document.getElementById("themeBtn");

btn.onclick = () => {
  document.body.classList.toggle("dark");

  if(document.body.classList.contains("dark")){
    localStorage.setItem("theme","dark");
    btn.textContent="â˜€ï¸";
  }else{
    localStorage.setItem("theme","light");
    btn.textContent="ðŸŒ™";
  }
};

// remember theme
if(localStorage.getItem("theme")==="dark"){
  document.body.classList.add("dark");
  btn.textContent="â˜€ï¸";
}

const mediaBtn = document.getElementById("mediaBtn");
const mediaPanel = document.getElementById("mediaPanel");
const chatBox = document.getElementById("chat");
const mediaGrid = document.getElementById("mediaGrid");

let mediaBuilt = false;

mediaBtn.onclick = () => {

  if(mediaPanel.style.display === "none"){
    chatBox.style.display = "none";
    mediaPanel.style.display = "block";
    mediaBtn.textContent = "â¬…";

    if(!mediaBuilt){
      buildMediaGallery();
      mediaBuilt = true;
    }

  }else{
    mediaPanel.style.display = "none";
    chatBox.style.display = "block";
    mediaBtn.textContent = "ðŸ“·";
  }
};


function buildMediaGallery(){

  fetch("chat.json")
  .then(r=>r.json())
  .then(data=>{

    data.forEach(m=>{

      if(!m.file) return;

      // images + stickers
      if(m.type==="image"){
        const img=document.createElement("img");
        img.src="media/"+m.file;

        img.onclick=()=>{
          window.open(img.src,"_blank");
        };

        mediaGrid.appendChild(img);
      }

      // videos
      if(m.type==="video"){
        const v=document.createElement("video");
        v.src="media/"+m.file;
        v.controls=true;
        mediaGrid.appendChild(v);
      }

    });

  });
}

});

</script>

</body>
</html>
